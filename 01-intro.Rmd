# Checklist {#sp-list}



```{r loadPack, echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)
library(sf)
library(mapview)
library(raster)
library(shiny)
library(ggplot2)
library(leaflet)
```


```{r loadData, echo=FALSE, message=FALSE, warning=FALSE}

ST <- st_read("ST_cast.shp", quiet = TRUE)
P <- st_read("P_cast.shp", quiet = TRUE)
protected_areas <- st_read("obo_np_stp.shp", quiet = TRUE)

combined_dataset <- 
  readxl::read_excel("combined_dataset_2021-10-21.xlsx")

endemic_list <-
  combined_dataset %>%
  filter(EndemicTS == "E") %>%
  dplyr::select(
    idtax_f,
    tax_infra_level,
    tax_fam,
    tax_gen,
    tax_famclass,
    starts_with("traitvalue"),
    taxo_unclear,
    status_revision_needed
  ) %>%
  distinct() %>%
  arrange(tax_fam, tax_infra_level)

```

```{r species1, echo=FALSE, message=FALSE, warning=FALSE}

id_sp <- endemic_list$idtax_f[1]

combined_dataset_sf <- 
  combined_dataset %>%
  filter(georef_final == 1, idtax_f == id_sp) %>%
  st_as_sf(coords = c("ddlon", "ddlat"))

st_crs(combined_dataset_sf) <- 4326

```


## *`r  endemic_list$tax_infra_level[1]`*



### Status 

_Vulnerable_

```{r, echo=FALSE, out.width="5%"}
knitr::include_graphics("./images/VU.png")
```

### Rationale

[*`r  endemic_list$tax_infra_level[1]`*](https://tropicos.org/name/100299918) is a perennial herb or shrub up 2 m tall. The species is endemic to the island of São Tomé. It occurs frequently, especially along streams, in primary or secondary montane forests and cacao plantations at elevations from 110 to 1630 m. This endemic species has a limited distribution but does not seem particularly rare. The species is known from 31 collections made between 1860 (*Welwitsch* 5208) and 2020 (*Lachenaud* 3003). Five collections (*Seabra* s.n., s.n.; *Oliveira* 1699; *Mann* 1096; *Welwitsch* 5208) do not have precise coordinates and were not taken into account for estimate the assessment parameters. The 26 remaining collections represent 17 occurrences, including nine within the Parc Natural de Obô de São Tomé (PNOST) and eight outside the protected area. These 17 current occurrences represent 2-4 subpopulations (the dissemination type is not known). Based on a 2 x 2 km cell size, the AOO is estimated as 48 km², below the upper threshold of the Endangered status under subcriterion B2. The EOO is calculated as 124.184 km², below the upper threshold of the Endangered status under subcriterion B1. Three occurrences were made outside the south of PNOST at Formosso Grande (*Farminhão* 108), near Cruzeiro (*Farminhão* 118), and on the way to Bombaim (*Joffroy* 53). They are threatened by illegal logging and represent one location. Two occurrences inside PNOST in West (*Lachenaud* 3003 West of Bambaim; Ogonovszky 328 Rio Ana Chaves) are not threatened and represent one location. The occurrences that are in the buffer zone of the PNOST (*Monod* 11907, 12005 West slope of Pico; *Rose* 307 Pico; *Ogonovszky* 271 Pico way down to Manuel Morais; *Joffroy* 176, *Lejoly* 12 between Pico of São Tomé and Monte Castro; *Matos* 7572 between Pico and Morro Vilela; *Matos* 7390 between Pico and Roça Ponta Figo; *Joffroy* 184 Rio do Ouro) represent one location, indirectly threatened by tourism that reduces the quality of its habitat. The occurrence in North West of PNOST (*Joffroy* 184) is threatened by illegal logging and represents one location. The occurrence of Chamiço (*Paiva* 1030) is threatened by small-scale agriculture and represents one location. The occurrence of Monte Figo (*Paiva* 208) is threatened by small-scale agriculture, and represents one location; we infer a future disappearance of this occurrence. The Nova Moca (*Moller* 128), Saudade (*Paiva* 338), and Monte Café (*Moller* 281; *Quintas* 91) occurrences are threatened by small-holder plantations (Cacao) and represent one location. Therefore, these 17 occurrences represent 7 locations (*sensu* IUCN, 2019), with regards to the most important threat (small-scale agriculture). We infer a continuing decline in the extent and quality of its habitat. We also infer a decline in its AOO, EOO, the number of mature individuals, and the number of subpopulations based on inferred future disappearance of one occurrence situated at Monte Figo. Therefore, *`r  endemic_list$tax_infra_level[1]`* is assessed as _VU_ B1ab(i,ii,iii,iv,v)+2ab(i,ii,iii,iv,v).


### Habitat and ecology

The species occur frequently (especially along streams) in montane primary or secondary forests and in cacao plantations at elevations from 400 to 1,630 m.

### Use and trade

It is not known if the species is used.

### Population

Even widespread in São Tomé, the species appears locally rare.


### Distribution

```{r echo=FALSE, message=FALSE, warning=FALSE}


map_ST <- 
  ggplot() +
  geom_sf(
    data = P,
    fill = "lightgrey",
    color = "black",
    lwd = NA
  ) +
  ggspatial::annotation_map_tile(type = "hotstyle",
                                 zoom = 12, 
                                 cachedir = system.file("rosm.cache", package = "ggspatial")) +
  labs(y= " ", x = " ") +
  scale_x_continuous(limits = c(6.45, 6.8)) +
  scale_y_continuous(limits = c(0, 0.41)) +
    ggsn::scalebar(dist = 5, dist_unit = "km",
                   transform = TRUE, model = "WGS84", 
                   x.min = 6.47, x.max = 6.55, 
                   y.min = 0.39, y.max = 0.409, 
                 st.dist = 1, height = 0.3) +
    geom_sf(data = protected_areas,
          fill = NA,
          color = "red",
          lwd = 0.5)

if (length(unique(combined_dataset_sf$extirpated)) > 1) {
  
  map_ST <- 
    map_ST +
      geom_sf(
    data = combined_dataset_sf %>% 
      mutate(extirpated = as.character(extirpated)),
    mapping = aes(color = extirpated)
  ) +
  scale_color_manual(name = " ", 
                    values = c("black", "red"),
                    labels = c("Occurrence representing a \nsubpopulation still present",
                               "Likely \nextirpated occurence")) +
  theme(panel.background = element_rect(fill = "white", colour = NA),
        legend.background = element_rect(fill = NA, colour = NA),
        legend.title = element_text(size = 10, face = "bold"),
        legend.key.size = unit(1,"line"),
        legend.position = c(0.7, 0.12),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.text = element_text(
    margin = margin(l = 10, unit = "pt")),
    legend.key.height = unit(1,"line"))
  
} else {
  
    map_ST <- 
    map_ST +
      geom_sf(
    data = combined_dataset_sf
  )
  
  
}


png(paste0(gsub(" ", "_", endemic_list$tax_infra_level[1]), "_", "ST", ".png"), 
    width = 30, height = 15, units = "cm", res = 400)
map_ST
invisible(dev.off())


map_lf <- 
  leaflet() %>%
  addProviderTiles(providers$OpenStreetMap, group =  "Open Street Map") %>%
  addProviderTiles(providers$Esri.WorldImagery, group =  "Esri") %>%
  addMarkers(data = combined_dataset_sf %>% 
               filter(extirpated == 0),
             popup = leafpop::popupTable(combined_dataset_sf %>% 
                                           filter(extirpated == 0) %>% 
                                                dplyr::select(idrb_n, idc,
                                                         colnam, nbr, coly, loc_notes, habitat) %>% 
                                           sf::st_set_geometry(NULL), 
                                         feature.id = FALSE, row.numbers = FALSE),
             group = "Likely still present occurrence",
             clusterOptions = markerClusterOptions())

if (length(unique(combined_dataset_sf$extirpated)) > 1) {
  
map_lf <- 
  map_lf %>%
  addCircleMarkers(data = combined_dataset_sf %>% 
               filter(extirpated == 1),
             popup = leafpop::popupTable(combined_dataset_sf %>% 
                                           filter(extirpated == 1) %>% 
                                           dplyr::select(idrb_n, idc,
                                                         colnam, nbr, coly, loc_notes, habitat) %>% 
                                           sf::st_set_geometry(NULL), 
                                         feature.id = FALSE, row.numbers = FALSE),
             group = "Likely extirpated occurrence",
             clusterOptions = markerClusterOptions())
  
}


  map_lf <- 
    map_lf %>% 
  addLayersControl(
  baseGroups = c("Open Street Map", "ESRI"),
    overlayGroups = c("Likely extirpated occurrence",
                      "Likely still present occurrence"),
    options = layersControlOptions(collapsed = F)
  )
  

  htmlwidgets::saveWidget(map_lf, "leaflet.html")
  # browseURL("leaflet.html")
  hh <- file.rename("leaflet.html", "D:/MonDossierR/stp_website_backup/static/img/leaflet.html")

```


```{r fig.show='asis', echo=FALSE, results='asis', message=FALSE, warning=FALSE, fig.cap="The known distribution of the species in São Tomé."}

map_ST

```


```{r leaflet, echo=FALSE, message=FALSE, warning=FALSE, fig.cap="An interactive map of known occurrences."}
knitr::include_url("https://cepf-stp-threat-flora.netlify.app/img/leaflet")
```



